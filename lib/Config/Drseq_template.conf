[General]
barcode_file = 
# barcode fastq : fastq file only, by default, every barcode in fastq file consist of 20 bp including 12bp cell barcode(1-12bp) and 8bp UMI(13-20bp). cell barcode should locate before UMI, the length of cell barcode and UMI can be defined below
cell_barcode_length = 12
umi_length = 8
# length of cell barcode and UMI, (see the annotation of barcoe_fastq). by default they are 12,8

reads_file = 
# reads fastq : accept raw sequencing file (fastq) or aligned file(sam), file type is specified by extension. (regard as raw file and add mapping step if .fastq, regard as aligned file if .sam)
# sam file should be with header

outputdirectory = 
# (absolute path)dir for all result
#default is current dir "." if user left it blank  , but not recommended
outname = 
# name of all your output results, your results will looks like outname.pdf, outname.txt

gene_annotation = /mnt/Storage3/home/huse/Dropseq/Drseq_data/refgenes/mm10_refgenes.txt 
# (absolute path) gene model in full text format, download from UCSC genome browser, eg:  /yourfolder/mm10_refgenes.txt  (absolute path, refseq version recommended )

genome_version = mm10
# genome version, should be corresponded to your gene_annotation file 

dryrun = 0
# only print cmd with out processing if dryrun =1 , default is 0
# only works for time consuming cmd like mapping

png_for_dot = 0
# only works for dotplots in individual cell QC
# set 1 to plot dotplots in individual cell QC in png format, otherwise they will be plotted in pdf format
# the format of other plots are fixed to pdf, because they are not so big. 


[Step1_Mapping]
mapping_software_main = STAR
### location of your mapping software, choose from STAR and bowtie2 (case sensitive), if you already install STAR(bowtie2) in your default path, type STAR directly, otherwise input absolute path of STAR(bowtie2)
mapping_p = 8
### number of alignment threads to launch
mapindex = /mnt/Storage3/home/huse/Dropseq/Drseq_data/refgenes/mapping_index/
### mapping index of your alignment tool, absolute path, 
#  mapping index should be built before you run this pipeline, note that STAR and bowtie2 use different index type(see STAR/bowtie2 document for more details.). 
#  user should prepare sub-folders with specific name under mapindex folder, for STAR, folder should look like mm10.star, for bowtie2, mm10.bowtie2
#  folder name and suffix should be fixed like example suggested and case sensitive
#  for bowtie2 index folder, the name of index should only contain genome version, /mnt/Storage3/home/huse/Dropseq/Drseq_data/mapping_index/mm10.bowtie2/mm10.1.bt2
#  eg:  /mnt/Storage3/home/huse/Dropseq/Drseq_data/mapping_idnex/mm10.star
#  eg: /mnt/Storage3/home/huse/Dropseq/Drseq_data/ mapping_index/mm10.bowtie2
samtools_main = samtools
### location of your samtools, type samtools here if installed in default path, other wise type absolute path 
q30filter = 1
### use q30 criteria to filter reads in samfile, choose from 0/1
### add a filter(q=30) with minimum mapping quality, set this parameter to 1(default) to turn on this option, set 0 to turn off

[Step2_ExpMat]
filterttsdistance = 0
### whether discard reads far away from tts, set filterttsdistance = 1 to turn on this function, default is not use,  
ttsdistance = 400
### default filter distance is 400bp, only take effect when filterttsdistance = 1 is set
covergncutoff = 100
### build-in parameter, only output cell_barcode with more than 100(default) genes covered, for following analysis and QC report 
### note that this parameter is only for visualization of QC report and convenience of following analysis, because too many cell_barcodes will influence users' interpretation of the QC report.
### users can change this parameter when the drop-seq sample don't have enouth coverage/read depth
### to determine "real cells" from cell_barcodes for clustering, users can change parameter in [Step4_Analysis] "covergncluster"
duplicate_measure = 1
### way to consider duplicate reads in each cell_barcode, 
# 1(default) : duplicate reads have same umi and same genomic location(position and strand)
# 2 : same umi only
# 3 : same genomic location only
# 0 : do not remove duplicate reads(keep all) 
umidis1 = 0
### default this function is turned off
### only take effect when duplicate_measure = 1 or 2, ignore this parameter if duplicate_measure = 0 or 3
## set 1 to turn on this combination, set 0(default) to turn off
# set 1 : if two reads have same cell_barcode and genomic location(chrom,position,strand) and their umi distance <= 1, regard them as same reads
# set 0(default) : regard them as same reads only when their umi distance = 0 and have same cell_barcode and genomic location 
 

[Step3_QC]
bulk_qc = 1
# 0 means do not conduct bulk qc, 1 means conduct bulk qc(time consuming)
gb_cover = geneBody_coverage.py 
read_gc = read_GC.py
read_nvc = read_NVC.py
read_qul = read_quality.py
### refer part of RseQC(Want et al., Bioinfomatics, 2012)
### RseQC should be installed before you run this pipeline. after you install RseQC , input the location(or absolute location) of the four required part

# below is individual qc parameter
select_cell_measure = 1
### method to select real cells from cell_barcodes, choose from 1 or 2
## 1 (default): cell_barcodes with more than 1000 genes covered are selected as real cells for following analysis including dimentional reduction and clustering, cutoff of covered gene number(1000, default) is determined in parameter "covergncluster"
## 2 : top 1000 cell_harcodes with highest umi count will be selected as real cells, number of highest umi cell(1000, default) is determined in parameter "topumicellnumber". Suitable for Drop-seq sample with known cell number
covergncluster = 1000 
### cell_barcodes with more than 1000(default) genes covered will be selected as cells for clustering
### this parameter takes effect only when "select_cell_measure" is set to 1
topumicellnumber = 1000
### top 1000(default) cell_barcodes with highest umi count will be selected as cells for clustering
### this parameter takes effect only when "select_cell_measure" is set to 2
remove_non_dup_cell = 1
### a group of cell_barcodes have almost no duplicate reads, which show clearly different pattern from real cells, we set an option to remove these cell_barcodes for analysis step.
### choose from 0 or 1, set 1(default) to turn on this function(remove non dup cell_barcodes), set 0 to turn off(keep non dup cell_barcodes)
non_dup_cutoff = 0.1
### cutoff of non-duplicate cell_barcode, a cell_barcode will be defined as non-duplicate cell_barcode if its duplicate rate < 0.1. Duplicate rate for each cell_barcode is defined as (#total_reads - #umi)/#total_reads



[Step4_Analysis]

### dimentional reduction step
highvarz = 1.64
### cutoff for high variance selection. in the first step we divide all genes to 20 groups based on average expression level across all individual cells. Then in each group we select genes whose z-normalized CV(var/mean) >= 1.64 (default, corresponding to pvalue =0.05) 
selectpccumvar = 0.5
### select topN PC until they explain 50% (0.5, default,  0.3 for 30% variance) of total variance. Then conduct 2 dimentional t-SNE based on selected PC
pctable = 1
### choose from 0(default) and 1, you can turn on this function(set 1) to output a 2 column table for PC1 v.s PC2
### this paramter is designed for users who prefer and conduct following analysis based on PCA output, generally we don't recommend
## 0(default) : do not output PCA result, only output PCA + 2 dimentional t-SNE result (see document for more details)
## 1 : output PC1 v.s. PC2 table in addition to t-SNE result.
cortable = 1
### choose from 0(default) and 1, you can turn on this function(set 1) to output a cell to cell correlation matrix
### correlation is based on log scale TPM(trsncript per million reads). 
### user can turn on this function to generate cell to cell correlation matrix for custom analysis

clustering_method = 1
### method for cluster cells based on t-SNE result
### choose from 1(default) ,2 ,3 and 4.
### 1(default) : k-means, use Gap statistics followed by our "first stable Gap" method to determine k, see document for more details
### 2 : k-means, but use Gap statistics followed by triditional "Tibs2001SEmax"  method to determine k (Tibshirani et al (2001))
### 3 : k-means with custom determined k, k value is defined in following parameter "custom_k", this option is designed for users who know the number of subgroup of the drop-seq sample
### 4 : (make sure your R enviroment has library "fpc" installed) use dbscan as clustering method, the (eps) parameter is defined in following parameter "custom_d"
maxknum = 100
### maximum k number for gap statistics, only take effect when clustering_method = 1 or 2
custom_k = 5
### only take effect when clustering_method = 3, cells will be clustered to N group based on t-SNE result according to user determined k
custom_d = 2
### only take effect when clustering_method = 4, its the parameter "eps"(Reachability distance, see Ester et al. (1996)) of dbscan
### by default we set it to 2 according to the orginal Drop-seq paper, but it varies a lot between differen datasets.

# Rscript analysis.r expmat outname coverGN highvarZ selectPCcutoff rdnumber maxKnum
rdnumber = 1007
### set initial random number to keep your result reproducible  





